<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="app" class="app"></div>
  <script type="module">
    // 原生的
    import {
      // h,
      // render,
      // Text,
      // Fragment,
      // ref
    } from '/node_modules/@vue/runtime-dom/dist/runtime-dom.esm-browser.prod.js';

    // 自己的
    import {
      h,
      render,
      Text,
      Fragment,
      ref
    } from './runtime-dom.js';

    // const VueComponent = {
    //   data() {
    //     return { name: 'zio', age: 1625 };
    //   },
    //   render(proxy) {
    //     // 只是例子，实际不能在render里更改data
    //     setTimeout(() => {
    //       this.age++;
    //       this.age++;
    //     }, 1000);
    //     return h(Fragment, [
    //       h(Text, this.name),
    //       h('span', this.age)
    //     ]);
    //   }
    // };
    // render(h(VueComponent), app);

    // const VueComponent = {
    //   data() {
    //     return { name: 'zio', age: 1625 };
    //   },
    //   render(proxy) {
    //     console.log('runner');
        
    //     return h(Fragment, [
    //       h('button', { onClick: () => { this.age++; this.name = this.name + '1'; } }, 'hit me'),
    //       h(Text, this.name),
    //       h('span', this.age)
    //     ]);
    //   }
    // };
    // render(h(VueComponent), app);


    // 属性
    // attrs(非响应式的) props(响应式的)
    // const VueComponent = {
    //   props: {
    //     // defineProps
    //     name: String,
    //     age: Number
    //   },
    //   data() {
    //     return { x: 'x', y: 'y', propsName: `这是props里的name属性：${this.name}` };
    //   },
    //   render(proxy) {
    //     console.log(proxy);
        
    //     // data、props直接proxy.获取，attrs要proxy.$attrs.获取
    //     // data可以修改（也不推荐在render里修改），props不能修改
    //     return h('div', [
    //       h(Text, this.name),
    //       h('span', this.age)
    //     ])
    //   }
    // };
    // render(h(VueComponent, { a: 1, b: 2, name: 'zio', age: 1043 }), app);


    // data、props、slots更新后，组件也会更新
    // 通过属性更新组件
    // const RenderComponent = {
    //   props: {
    //     address: String
    //   },
    //   render(proxy) {
    //     return h(Text, this.address);
    //   }
    // };
    // const VueComponent = {
    //   data() {
    //     return { flag: true, flag_2: true };
    //   },
    //   render(proxy) {
    //     console.log('runner');
        
    //     return h(Fragment, [
    //       h('button', { onClick: () => { this.flag = !this.flag; this.flag_2 = !this.flag_2; } }, 'hit me'),
    //       // 实验不是用户定义的props，也被放入instance.props了
    //       h(RenderComponent, { address: this.flag ? 'zio' : 'ded', a: this.flag ? 1 : 2})
    //     ]);
    //   }
    // };
    // render(h(VueComponent), app);

    // const VueComponent = {
    //   data() {
    //     return { name: 'zio', age: 1625 };
    //   },
    //   render(proxy) {
    //     console.log('runner');
        
    //     return h(Fragment, [
    //       h('button', { onClick: () => { this.age++; this.name = this.name + '1'; } }, 'hit me'),
    //       h(Text, this.name),
    //       h('span', this.age)
    //     ]);
    //   }
    // };
    // render(h(VueComponent), app);
    // setTimeout(() => {
    //   render(h(VueComponent, {a: 1, b: 2}), app);
    // }, 1000);

    // const RenderComponent = {
    //   props: {
    //     a: Number,
    //     b: Number
    //   },
    //   render(proxy) {
    //     return h('div', this.a + this.b);
    //   }
    // };
    // const VueComponent = {
    //   data() {
    //     return { fa: 1, fb: 2 };
    //   },
    //   render(proxy) {
    //     console.log('runner');
        
    //     return h(Fragment, [
    //       h('button', { onClick: () => { this.fa = 10; this.fb = 20; } }, 'hit me'),
    //       // 实验不是用户定义的props，也被放入instance.props了
    //       h(RenderComponent, { a: this.fa, b: this.fb})
    //     ]);
    //   }
    // };
    // render(h(VueComponent), app);
    // 父componentUpdateFn -> patch -> patchChildren -> patchComponent -> updateComponent（n2复用n1.component） -> 改变子instance.next(初始挂载时会把instance赋值到vNode.component上) -> instance.update -> 子componentUpdateFn

    const VueComponent = {
      setup() {
        const a = ref(1);
        setTimeout(() => {
          a.value = 2;
        }, 1000);

        return {
          a
        }
        // return () => h('div', a.value);
      },
      // 相当于html模版
      render(proxy) {
        // return h('div', proxy.a);
        return h(Fragment, [
          h('button', {onClick: () => { proxy.a++ }}, '+++'),
          h('div', proxy.a)
        ])
      }
    }
    render(h(VueComponent), app);
  </script>
</body>
</html>